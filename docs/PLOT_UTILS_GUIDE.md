# Plot Utils Guide

This guide explains how to use the `plot_utils` module for creating publication-quality figures in the Zero-DCE project.

## Overview

The `plot_utils` module provides consistent matplotlib styling across all visualization scripts. It ensures that all plots generated by the project follow a uniform style suitable for academic manuscripts.

## Features

- **Automatic LaTeX detection**: Enables LaTeX rendering for professional mathematical typesetting if available
- **Consistent typography**: Uses serif fonts and appropriate sizes for manuscripts
- **Colorblind-friendly palette**: Ensures plots are accessible to readers with color vision deficiencies
- **Graceful fallback**: Works perfectly even without LaTeX installed
- **DRY principle**: Single source of truth for all plotting configurations

## Quick Start

### Basic Usage

Simply import and call `configure_publication_style()` at the beginning of your script:

```python
import matplotlib.pyplot as plt
from plot_utils import configure_publication_style

# Apply publication styling
configure_publication_style()

# Now create your plots as usual
plt.figure(figsize=(8, 6))
plt.plot([1, 2, 3], [1, 4, 9])
plt.xlabel('X axis')
plt.ylabel('Y axis')
plt.title('My Plot')
plt.savefig('output.png', dpi=300)
```

### Already Applied in Project Scripts

The publication style is already configured in:
- `compare.py` - Comparison visualizations
- `train.py` - Training history plots

You don't need to do anything extra when using these scripts!

## Configuration Details

### Font Settings

The publication style configures the following font properties:

```python
{
    "text.usetex": True/False,   # LaTeX rendering (auto-detected)
    "font.family": "serif",       # Serif fonts for academic style
    "axes.labelsize": 10,         # Axis label font size
    "font.size": 10,              # Default font size
    "legend.fontsize": 8,         # Legend font size
    "xtick.labelsize": 8,         # X-axis tick label size
    "ytick.labelsize": 8,         # Y-axis tick label size
}
```

### Color Palette

Uses the `seaborn-v0_8-colorblind` style, which provides:
- Distinguishable colors for colorblind readers
- Professional appearance
- Consistent color scheme across all plots

## LaTeX Support

### Automatic Detection

The module automatically detects if LaTeX is installed:

```python
from plot_utils import check_latex_available

if check_latex_available():
    print("LaTeX is available - plots will use LaTeX rendering")
else:
    print("LaTeX not found - using standard matplotlib rendering")
```

### Installing LaTeX (Optional)

LaTeX is **not required** but recommended for publication-quality figures.

#### Linux

```bash
# Debian/Ubuntu
sudo apt-get install texlive texlive-latex-extra cm-super dvipng

# Arch Linux
sudo pacman -S texlive-core texlive-bin texlive-latexextra

# Fedora/RHEL
sudo dnf install texlive texlive-latex texlive-dvipng
```

#### macOS

```bash
# Install MacTeX (full distribution, ~4GB)
brew install --cask mactex

# Or BasicTeX (minimal, ~90MB)
brew install --cask basictex
```

#### Windows (WSL2)

```bash
# In WSL2 Ubuntu terminal
sudo apt-get install texlive texlive-latex-extra cm-super dvipng
```

### What If I Don't Have LaTeX?

No problem! The module gracefully falls back to standard matplotlib rendering:
- A warning message will be shown once when you first use the utilities
- All plots will still work perfectly
- The only difference is text rendering (no LaTeX math mode)

This is fine for:
- Development and testing
- Quick visualizations
- Presentations
- Non-publication work

LaTeX rendering is mainly needed for:
- Academic papers and manuscripts
- Publications requiring specific typesetting standards
- Professional mathematical notation

## Advanced Usage

### Getting Style Configuration Without Applying

If you want to inspect or modify the style configuration:

```python
from plot_utils import get_publication_style
import matplotlib as mpl

# Get the style dictionary
style = get_publication_style()
print(style)

# Modify if needed
style['font.size'] = 12

# Apply manually
mpl.rcParams.update(style)
```

### Checking LaTeX Availability Programmatically

```python
from plot_utils import check_latex_available

latex_available = check_latex_available()

if latex_available:
    # Use LaTeX-specific features (e.g., math mode)
    plt.xlabel(r'$\alpha$ (learning rate)')
else:
    # Use plain text
    plt.xlabel('alpha (learning rate)')
```

### Using in New Scripts

When creating new visualization scripts, follow this pattern:

```python
#!/usr/bin/env python3
"""My new visualization script."""

import matplotlib.pyplot as plt
import numpy as np
from plot_utils import configure_publication_style

# Apply publication style at the beginning
configure_publication_style()

def main():
    """Main function."""
    # Your plotting code here
    fig, ax = plt.subplots(figsize=(8, 6))
    ax.plot([1, 2, 3], [1, 4, 9])
    ax.set_xlabel('X axis')
    ax.set_ylabel('Y axis')
    plt.savefig('output.png', dpi=300, bbox_inches='tight')

if __name__ == '__main__':
    main()
```

## Examples

### Training History Plots

See `train.py` for a complete example of plotting training curves:

```python
from plot_utils import configure_publication_style

configure_publication_style()

# Plot training metrics
plt.figure(figsize=(10, 6))
plt.plot(history.history['loss'], label='Training Loss')
plt.plot(history.history['val_loss'], label='Validation Loss')
plt.xlabel('Epochs')
plt.ylabel('Loss')
plt.title('Training and Validation Loss Over Epochs')
plt.legend()
plt.grid()
plt.savefig('loss_curve.png', dpi=300)
```

### Comparison Visualizations

See `compare.py` for image comparison plots:

```python
from plot_utils import configure_publication_style

configure_publication_style()

# Create multi-panel comparison
fig, axes = plt.subplots(2, 3, figsize=(15, 10))
for idx, (title, img) in enumerate(results.items()):
    ax = axes.flat[idx]
    ax.imshow(img)
    ax.set_title(title)
    ax.axis('off')
plt.tight_layout()
plt.savefig('comparison.png', dpi=150, bbox_inches='tight')
```

## Saving Publication-Quality Figures

### Recommended Settings

For manuscripts and publications:

```python
plt.savefig(
    'figure.pdf',          # Vector format (PDF, EPS, SVG)
    dpi=300,               # High resolution
    bbox_inches='tight',   # Remove excess whitespace
    pad_inches=0.1,        # Small padding
    format='pdf'           # Explicitly specify format
)
```

For presentations and web:

```python
plt.savefig(
    'figure.png',
    dpi=150,               # Medium resolution (good balance)
    bbox_inches='tight',
    format='png'
)
```

### Format Recommendations

- **PDF/EPS**: Best for LaTeX manuscripts (vector format, scalable)
- **PNG**: Good for presentations, websites (raster format)
- **SVG**: Best for web/interactive (vector format, web-compatible)

## Troubleshooting

### Warning: "LaTeX not found on system"

**This is normal if you don't have LaTeX installed.** The warning appears once and can be safely ignored. Your plots will still work perfectly with standard matplotlib rendering.

To suppress the warning, either:
1. Install LaTeX (see installation instructions above)
2. Ignore it (recommended for development)

### Plots Look Different from Expected

If plots don't look as expected:

1. **Check if style is applied**: Make sure you call `configure_publication_style()` before creating plots
2. **Multiple style applications**: Calling the function multiple times is safe
3. **Notebook environments**: In Jupyter notebooks, you may need to re-run the style configuration after kernel restart

### Font Size Issues

If fonts appear too small or too large:

```python
from plot_utils import get_publication_style
import matplotlib as mpl

style = get_publication_style()
style['font.size'] = 12  # Adjust as needed
mpl.rcParams.update(style)
```

### Color Palette Not Applied

If the colorblind-friendly palette doesn't seem to work:

1. Check your matplotlib version: `import matplotlib; print(matplotlib.__version__)`
2. For matplotlib 3.6+, the style name is `seaborn-v0_8-colorblind`
3. For older versions, it falls back to `seaborn-colorblind`
4. The module handles this automatically

## Best Practices

### Do's

✅ Call `configure_publication_style()` once at the beginning of your script
✅ Use `bbox_inches='tight'` when saving figures
✅ Save figures in vector formats (PDF, EPS, SVG) for publications
✅ Use high DPI (300) for publication-quality raster images
✅ Test your plots without LaTeX to ensure they still look good

### Don'ts

❌ Don't modify matplotlib rcParams directly in multiple places
❌ Don't use hardcoded font sizes in individual plots
❌ Don't save low-resolution images (< 150 DPI) for publications
❌ Don't ignore LaTeX rendering errors (check your LaTeX syntax)

## Integration with Other Tools

### Jupyter Notebooks

```python
# In first cell
%matplotlib inline
from plot_utils import configure_publication_style
configure_publication_style()

# Now create plots in any cell
import matplotlib.pyplot as plt
plt.plot([1, 2, 3], [1, 4, 9])
plt.show()
```

### GUI Applications

For PyQt6/PyQt5 applications:

```python
from matplotlib.backends.backend_qt5agg import FigureCanvasQTAgg
from matplotlib.figure import Figure
from plot_utils import configure_publication_style

configure_publication_style()

class PlotCanvas(FigureCanvasQTAgg):
    def __init__(self, parent=None):
        fig = Figure()
        super().__init__(fig)
        # Plots will use publication style automatically
```

## Testing

The module includes comprehensive tests in `tests/test_plot_utils.py`:

```bash
# Run all tests
pytest tests/test_plot_utils.py -v

# Run specific test class
pytest tests/test_plot_utils.py::TestLatexDetection -v
```

## Contributing

When adding new visualization features:

1. **Use the utilities**: Always import and use `configure_publication_style()`
2. **Don't duplicate**: Don't copy the style configuration to new files
3. **Extend if needed**: If you need different styles, add them to `plot_utils.py`
4. **Write tests**: Add tests for any new functionality

## References

- [Matplotlib Configuration Guide](https://matplotlib.org/stable/tutorials/introductory/customizing.html)
- [LaTeX in Matplotlib](https://matplotlib.org/stable/tutorials/text/usetex.html)
- [Colorblind-Friendly Palettes](https://matplotlib.org/stable/tutorials/colors/colormaps.html)

---

**Last Updated:** 2025-12-05
**Module:** `plot_utils.py`
**Related Files:** `compare.py`, `train.py`, `tests/test_plot_utils.py`
